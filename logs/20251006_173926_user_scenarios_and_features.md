# 小学生向けScratch学習支援システム - ユーザー使用シナリオと機能一覧

作成日: 2025年10月6日

---

## 目次

1. [システム概要](#システム概要)
2. [ユーザー役割](#ユーザー役割)
3. [学生ユーザーの使用シナリオ](#学生ユーザーの使用シナリオ)
4. [管理者の使用シナリオ](#管理者の使用シナリオ)
5. [機能一覧](#機能一覧)
6. [画面遷移フロー](#画面遷移フロー)

---

## システム概要

本システムは小学生がScratchプログラミングを通じて計算的思考を学ぶための学習支援Webアプリケーションです。4つの問題形式により、基礎から応用まで段階的に学習できます。

### 対象ユーザー
- **主要ユーザー**: 小学1年生〜6年生
- **副次ユーザー**: 教師・管理者（学習データの分析・管理）

### 学習形式
- チャプター制: テーマごとに分かれた学習単元
- 4つの問題タイプ: 穴埋め、予測、バグ発見、ミッション
- レベル制: 経験値を獲得してレベルアップ
- 適応的学習: 学年に応じたヒント提供

---

## ユーザー役割

### 1. 学生ユーザー
- アカウント登録とログイン
- 問題の解答と提出
- 進捗管理と学習履歴閲覧
- レベルアップとEXP獲得

### 2. 管理者
- 問題コンテンツの管理
- 学習データの分析
- ユーザー管理
- システム統計の閲覧

---

## 学生ユーザーの使用シナリオ

### シナリオ1: 初めての学習 (新規ユーザー)

**背景**: 小学3年生の太郎くんが、学校でScratchを習い始めたので、自宅で復習したい

#### ステップ

1. **アカウント登録**
   - トップページで「新規登録」をクリック
   - ユーザー名「taro123」、ニックネーム「太郎」、学年「3」、パスワードを入力
   - 登録ボタンをクリック → 自動的にログイン状態へ

2. **チャプター選択**
   - ダッシュボードが表示される
   - 現在のレベルとEXPを確認（初期: レベル1、EXP 0）
   - 「チャプター一覧」をクリック
   - Chapter 1: 順次処理 を選択

3. **問題1: 穴埋め問題に挑戦**
   - 問題タイトル「ネコを歩かせよう」が表示される
   - 問題説明を読む: ネコを右に50歩動かす→「こんにちは!」と2秒言う→100歩動かす
   - 「Scratchで解く」ボタンをクリック → Scratchエディタが新しいタブで開く
   - Scratchエディタでプログラムを作成
   - 「ファイル」→「コンピューターに保存」で.sb3ファイルを保存
   - 問題ページに戻り、「解答ファイルをアップロード」ボタンをクリック
   - .sb3ファイルを選択してアップロード

4. **採点結果の確認**
   - 採点結果が表示: 「正解です！100点」
   - +100 EXPを獲得
   - レベルが1→2にアップ（レベルアップ通知表示）
   - 次の問題へ進むボタンが表示される

5. **ヒント機能の使用**
   - 次の問題が難しい場合、「ヒントを見る」ボタンをクリック
   - 学年（3年生）に合わせたヒントが表示される
   - ヒントを参考に再チャレンジ

---

### シナリオ2: 予測問題の解答 (座標入力)

**背景**: 花子さんが問題2「ネコはどこかな？」に挑戦

#### ステップ

1. **問題内容の確認**
   - 問題タイプ: 🔮 予測問題
   - 説明を読む: 「プログラムを実行すると、ネコはどこに移動するでしょうか？」
   - 「Scratchで確認」ボタンをクリック → 問題のScratchプロジェクトが開く

2. **Scratchで動作確認**
   - Scratchエディタでプログラムを読む
   - 頭の中で座標を計算（または紙に書いて計算）
   - プログラムは実行せず、予測を立てる

3. **座標の入力**
   - 問題ページに戻る
   - X座標の入力欄に「30」を入力
   - Y座標の入力欄に「0」を入力
   - 「解答を提出」ボタンをクリック

4. **採点結果**
   - **ケース1: 両方正解**
     - 「正解です！100点」
     - +100 EXP獲得
   - **ケース2: 片方のみ正解**
     - 「惜しい！50点 - X座標は正解ですが、Y座標が違います」
     - +50 EXP獲得
     - もう一度考え直して再提出可能
   - **ケース3: 両方不正解**
     - 「不正解です。0点 - もう一度プログラムを読んで、座標の変化を追ってみましょう」
     - ヒントボタンが強調表示される

---

### シナリオ3: バグ発見問題への挑戦

**背景**: 太郎くんが問題3「準備の順番が間違っているよ！」に挑戦

#### ステップ

1. **問題の確認**
   - 問題タイプ: 🐛 バグ発見問題
   - 「このプログラムには間違いがあります。正しく動くように修正しましょう」
   - 「Scratchで解く」をクリック

2. **バグの発見と修正**
   - Scratchエディタでプログラムを実行してみる
   - 意図した動作と実際の動作の違いを確認
   - ブロックの順番を入れ替えて修正
   - 再度実行して正しく動作することを確認

3. **解答提出**
   - 修正したプログラムを.sb3ファイルとして保存
   - 問題ページでファイルをアップロード
   - 採点結果を確認

---

### シナリオ4: ミッション問題で創造性を発揮

**背景**: 花子さんが問題4「階段を登るプログラムを作ろう」に挑戦

#### ステップ

1. **ミッション内容の確認**
   - 問題タイプ: 🚀 ミッション問題
   - 「ネコが階段を登るようにプログラムを作りましょう。右に動いて、上に動いて、を繰り返します」
   - 難易度: ⭐⭐⭐⭐ (レベル4)

2. **自由な発想でプログラム作成**
   - Scratchエディタで自由にプログラムを作成
   - 試行錯誤しながら階段の動きを実現
   - 色々な方法を試してみる

3. **提出と評価**
   - 完成したプログラムを提出
   - 正解の基準: 階段を登る動きができていればOK
   - 高得点獲得: +150 EXP

---

### シナリオ5: 進捗管理と復習

**背景**: 太郎くんが自分の学習状況を確認したい

#### ステップ

1. **ダッシュボードで全体確認**
   - 現在のレベル: レベル5
   - 獲得EXP: 450 / 500（次のレベルまであと50）
   - クリア済み問題数: 4 / 4（Chapter 1完了）

2. **提出履歴の閲覧**
   - 「提出履歴」メニューをクリック
   - 過去の提出記録がリスト表示される
   - 各問題の得点、提出日時を確認

3. **再チャレンジ**
   - 満点でなかった問題を再度解く
   - より良いプログラムを作成して提出
   - 最高得点が更新される

---

## 管理者の使用シナリオ

### シナリオ6: 新しい問題の追加

**背景**: 先生が新しいChapter 2の問題を追加したい

#### ステップ

1. **管理者ログイン**
   - 管理者ログインページでユーザー名「admin」、パスワード「admin123」を入力
   - 管理者ダッシュボードにリダイレクト

2. **問題管理ページへ移動**
   - 左メニューから「問題管理」をクリック
   - 全問題の一覧がテーブル形式で表示される

3. **問題の正解ファイルをアップロード**
   - 対象の問題の「正解ファイル更新」ボタンをクリック
   - モーダルウィンドウが開く
   - 問題タイトルを確認: 「問題5: 繰り返しを使おう」
   - Scratchで作成した正解プログラムの.sb3ファイルを選択
   - 「アップロード」ボタンをクリック
   - 成功メッセージが表示される

4. **Scratch URLの設定**
   - 同じ問題の「URL編集」ボタン（青色）をクリック
   - URL編集モーダルが開く
   - Scratch URLを入力: `https://scratch.mit.edu/projects/1234567/editor/`
   - 「保存」ボタンをクリック

5. **予測問題の正解座標設定**
   - 予測問題の「正解座標編集」ボタン（紫色）をクリック
   - 正解座標編集モーダルが開く
   - X座標: 150
   - Y座標: 100
   - 「保存」ボタンをクリック

---

### シナリオ7: 学習データの分析

**背景**: 先生が生徒たちの学習状況を把握したい

#### ステップ

1. **統計情報の確認**
   - 管理者ダッシュボードで全体統計を確認
   - 総ユーザー数: 30人
   - 総提出数: 120件
   - 平均スコア: 75点

2. **問題分析**
   - 「問題分析」タブをクリック
   - 各問題の統計を確認:
     - 提出回数
     - 平均点
     - 正解率
   - 難しい問題を特定（正解率が低い問題）

3. **個別ユーザーの詳細確認**
   - 「ユーザー管理」メニューをクリック
   - ユーザー一覧から特定の生徒を選択
   - 生徒の詳細ページで確認:
     - 現在のレベルとEXP
     - 学年
     - 提出履歴（問題ごとの得点と提出日時）
     - 学習進捗（クリア済み問題数）

4. **データに基づく改善**
   - 正解率が低い問題のヒントを充実させる
   - つまずきやすいポイントを授業で補足

---

### シナリオ8: ユーザー管理

**背景**: 新学期が始まり、新しい生徒が登録された

#### ステップ

1. **ユーザー一覧の確認**
   - 「ユーザー管理」をクリック
   - 全ユーザーがテーブル形式で表示される
   - フィルター機能で学年別に絞り込み（例: 3年生のみ）

2. **個別ユーザーの詳細確認**
   - 気になる生徒のユーザー名をクリック
   - ユーザー詳細ページが開く
   - 学習履歴、レベル、提出状況を確認

3. **問題のある生徒のフォロー**
   - 提出が少ない生徒を特定
   - 個別に声をかけてサポート

---

## 機能一覧

### 共通機能

| 機能カテゴリ | 機能名 | 説明 |
|------------|--------|------|
| 認証 | ユーザー登録 | 学生が新規アカウントを作成（ユーザー名、パスワード、ニックネーム、学年） |
| 認証 | ログイン/ログアウト | JWT認証によるセキュアなログイン |
| 認証 | 管理者ログイン | 管理者専用の認証エンドポイント |
| UI | レスポンシブデザイン | PC、タブレット対応のレイアウト |
| UI | ナビゲーション | ヘッダーメニューによる画面遷移 |

---

### 学生ユーザー機能

| 機能カテゴリ | 機能名 | 説明 | 画面 |
|------------|--------|------|------|
| **ダッシュボード** | ||||
| | レベル表示 | 現在のレベルとEXPを表示 | ダッシュボード |
| | EXPバー | 次のレベルまでの進捗をビジュアル表示 | ダッシュボード |
| | 統計サマリー | クリア済み問題数などの概要 | ダッシュボード |
| **学習機能** | ||||
| | チャプター一覧 | 学習可能なチャプターを表示 | チャプター一覧 |
| | 問題一覧 | チャプター内の問題リストを表示 | 問題一覧 |
| | 問題詳細 | 問題文、難易度、問題タイプを表示 | 問題詳細 |
| | Scratch連携 | Scratchエディタを新しいタブで開く | 問題詳細 |
| **解答提出** | ||||
| | SB3ファイルアップロード | 穴埋め、バグ発見、ミッション問題の解答を.sb3形式で提出 | 問題詳細 |
| | 座標入力フォーム | 予測問題でX/Y座標を数値入力 | 問題詳細（予測問題） |
| | 自動採点 | 提出後即座に採点結果を表示 | 採点結果画面 |
| | スコア表示 | 0〜100点のスコアを表示 | 採点結果画面 |
| | フィードバック | 正解/不正解のメッセージと詳細 | 採点結果画面 |
| | 部分点（予測問題） | X/Yどちらが正解かを明示 | 採点結果画面 |
| **学習支援** | ||||
| | ヒント機能 | 学年に応じた段階的ヒントを表示 | 問題詳細 |
| | EXP獲得 | 正解に応じてEXPを獲得 | 採点結果画面 |
| | レベルアップ | 一定EXPでレベルアップ（通知表示） | 全画面 |
| **進捗管理** | ||||
| | 提出履歴 | 過去の全提出記録を表示 | 提出履歴 |
| | 再提出 | 同じ問題に何度でも挑戦可能 | 問題詳細 |
| | 最高得点記録 | 同一問題の最高得点を保持 | データベース |

---

### 管理者機能

| 機能カテゴリ | 機能名 | 説明 | 画面 |
|------------|--------|------|------|
| **ダッシュボード** | ||||
| | システム統計 | 総ユーザー数、総提出数、平均スコア | 管理者ダッシュボード |
| | 概要表示 | システム全体の健全性を一目で確認 | 管理者ダッシュボード |
| **問題管理** | ||||
| | 問題一覧表示 | 全問題をテーブル形式で表示 | 問題管理 |
| | 正解SB3アップロード | 問題の正解ファイルを更新（モーダル形式） | 問題管理 |
| | Scratch URL編集 | 問題ごとのScratchエディタURLを設定（モーダル形式、青色） | 問題管理 |
| | 正解座標編集 | 予測問題の正解X/Y座標を設定（モーダル形式、紫色） | 問題管理 |
| | 問題情報表示 | ID、チャプター、タイトル、種類、難易度、順序 | 問題管理 |
| | モーダルUI | 直感的なモーダルウィンドウで編集操作 | 問題管理 |
| **ユーザー管理** | ||||
| | ユーザー一覧 | 全学生ユーザーをテーブル表示 | ユーザー管理 |
| | ユーザー詳細 | 個別ユーザーの詳細情報と学習履歴 | ユーザー詳細 |
| | 学年別表示 | 学年でフィルタリング可能 | ユーザー管理 |
| **分析機能** | ||||
| | 問題分析 | 問題ごとの提出回数、平均点、正解率 | 問題分析 |
| | ユーザー分析 | ユーザーごとの学習状況と進捗 | ユーザー管理 |
| | データエクスポート | 学習データのダウンロード（今後実装予定） | - |

---

## 画面遷移フロー

### 学生ユーザーの画面遷移

```
[トップページ]
    ↓
    ├─ [新規登録] → [登録完了] → [ダッシュボード]
    └─ [ログイン] → [ダッシュボード]
                        ↓
                   [チャプター一覧]
                        ↓
                   [問題一覧（チャプター別）]
                        ↓
                   [問題詳細]
                        ↓
                        ├─ [Scratchエディタ]（外部リンク）
                        ├─ [ヒント表示]
                        └─ [解答提出]
                            ↓
                        [採点結果]
                            ↓
                        [次の問題] or [問題一覧に戻る]

[ダッシュボード]
    ↓
[提出履歴] → [過去の提出詳細]
```

### 管理者の画面遷移

```
[管理者ログイン]
    ↓
[管理者ダッシュボード]
    ↓
    ├─ [ユーザー管理]
    │    ↓
    │   [ユーザー詳細]
    │
    ├─ [問題管理]
    │    ↓
    │   [問題編集モーダル]
    │    ├─ URL編集モーダル
    │    ├─ 正解座標編集モーダル
    │    └─ 正解ファイル更新モーダル
    │
    └─ [問題分析]
```

---

## 問題タイプ別の詳細仕様

### 1. 📝 穴埋め問題 (fill_blank)

**目的**: 基本的なブロックの使い方を学ぶ

**提出方法**: .sb3ファイルアップロード

**採点方法**:
- 正解プログラムのJSONと提出プログラムのJSONを比較
- ブロックの種類と配置が一致していればOK

**難易度**: ⭐ (レベル1)

**例**:
- 「ネコを歩かせよう」: 指定された動きを実現するブロックを配置

---

### 2. 🔮 予測問題 (predict)

**目的**: プログラムの動作を理解し、座標計算能力を養う

**提出方法**: X座標とY座標を数値入力

**採点方法**:
- 両方正解: 100点
- X座標のみ正解: 50点（「Y座標が違います」とフィードバック）
- Y座標のみ正解: 50点（「X座標が違います」とフィードバック）
- 両方不正解: 0点

**難易度**: ⭐⭐ (レベル2)

**例**:
- 「ネコはどこかな？」: プログラムを読んで最終的な座標を予測

---

### 3. 🐛 バグ発見問題 (find_error)

**目的**: デバッグ能力を養う

**提出方法**: .sb3ファイルアップロード

**採点方法**:
- 修正されたプログラムが正解プログラムと一致すればOK
- ブロックの順序や値が正しく修正されているか確認

**難易度**: ⭐⭐⭐ (レベル3)

**例**:
- 「準備の順番が間違っているよ！」: ブロックの順序を正しく並び替える

---

### 4. 🚀 ミッション問題 (mission)

**目的**: 創造性と応用力を発揮

**提出方法**: .sb3ファイルアップロード

**採点方法**:
- 指定された動作が実現できていればOK
- より柔軟な採点基準

**難易度**: ⭐⭐⭐⭐ (レベル4)

**例**:
- 「階段を登るプログラムを作ろう」: 自由な発想で階段の動きを実現

---

## データフロー

### 提出から採点までの流れ

```
[学生] → [フロントエンド]
           ↓
        [Axios API Call]
           ↓
    [バックエンド Express]
           ↓
        [認証ミドルウェア] (JWT検証)
           ↓
    [submissionController]
           ↓
        ├─ [予測問題の場合]
        │    ↓
        │   座標比較 (X, Y)
        │    ↓
        │   スコア計算 (0, 50, 100)
        │
        └─ [その他の問題]
             ↓
            JSZipでSB3解析
             ↓
            JSON比較
             ↓
            スコア計算 (0 or 100)
           ↓
    [データベース保存]
        ├─ submissions テーブル (最終提出)
        └─ submission_attempts テーブル (全試行)
           ↓
    [EXP計算とレベルアップ]
           ↓
    [usersテーブル更新]
           ↓
    [レスポンス返却]
           ↓
    [フロントエンド]
           ↓
    [採点結果画面表示]
```

---

## セキュリティとデータ保護

### 認証
- JWT (JSON Web Token) による安全な認証
- パスワードはbcryptでハッシュ化して保存
- トークンはlocalStorageに保存（学生/管理者別）

### 権限管理
- 学生は自分のデータのみアクセス可能
- 管理者は全データにアクセス可能
- ミドルウェアで権限チェック (`authMiddleware`, `adminAuthMiddleware`)

### データ保護
- 提出データは全てデータベースに記録（研究用）
- ユーザーのパスワードは平文保存しない
- SQL injection対策（パラメータ化クエリ）

---

## 今後の拡張可能性

### 短期的な改善
- [ ] 問題の新規作成UI
- [ ] チャプターの追加・編集機能
- [ ] より詳細な学習分析グラフ
- [ ] エクスポート機能（CSV、Excel）
- [ ] リアルタイム通知機能

### 中期的な機能追加
- [ ] 複数の学習コース
- [ ] 協同学習機能（グループワーク）
- [ ] バッジ・アチーブメントシステム
- [ ] 親・教師へのレポート機能
- [ ] AIによる学習サポート

### 長期的なビジョン
- [ ] モバイルアプリ化
- [ ] 他のプログラミング言語への拡張
- [ ] オンライン授業との統合
- [ ] ゲーミフィケーション強化

---

## まとめ

本システムは小学生が楽しくScratchを学べる環境を提供し、以下の価値を実現します：

1. **段階的な学習**: 4つの問題タイプで基礎から応用へ
2. **即時フィードバック**: 自動採点で素早い学習サイクル
3. **モチベーション維持**: レベルアップシステムによるゲーミフィケーション
4. **適応的学習**: 学年に応じたヒント提供
5. **データドリブン**: 管理者が学習データを分析して改善

教育現場での実用性と研究データの収集を両立した、実践的な学習支援システムです。
