# 第3章「提案」執筆用詳細資料 - Scratch学習支援システム

本ドキュメントは、論文の第3章「提案」を執筆する際に参照する詳細資料です。
先輩の論文の構成を参考に、あなたのシステムの各要素を整理しています。

---

## 目次構成案(先輩の論文を参考)

```
第3章 提案
3.1 Scratch学習支援システム概要
3.2 使用技術
3.3 Webアプリケーション内容
  3.3.1 アプリケーションの流れ(状態遷移図)
  3.3.2 ホーム画面
  3.3.3 ログイン画面
  3.3.4 ユーザー登録画面
  3.3.5 章選択画面
  3.3.6 問題一覧画面
  3.3.7 問題詳細画面
  3.3.8 提出・フィードバック画面
  3.3.9 進捗管理画面
  3.3.10 管理者ダッシュボード
  3.3.11 データベースについて
3.4 バックエンド・フロントエンドの機能分担
3.5 自動採点エンジン(v2.1)
  3.5.1 採点エンジン概要
  3.5.2 変数マッピング機能(v2.1の核心)
  3.5.3 セマンティック比較アルゴリズム
  3.5.4 フィードバック生成ロジック
3.6 4種類の問題タイプ
  3.6.1 穴埋め式問題(fill_blank)
  3.6.2 予測問題(predict)
  3.6.3 間違い探し問題(find_error)
  3.6.4 ミッション型問題(mission)
```

---

## 3.1 Scratch学習支援システム概要

### 3.1.1 システムの目的

本システムは、小学3〜6年生を対象とした**試行錯誤型のプログラミング学習支援システム**である。

**従来の模倣学習の問題点**:
- 完成見本を真似るだけで、プログラミング的思考が育たない
- 試行錯誤の経験が不足
- 応用力が身につかない

**本システムのアプローチ**:
- **4種類の問題タイプ**により、段階的に思考力を育成
- **.sb3ファイルの自動採点**により、即座にフィードバック
- **変数マッピング機能(v2.1)**により、変数名の違いを吸収し、本質的な理解を評価
- **学年別適応型ヒント**により、発達段階に応じた支援を提供

### 3.1.2 システムの全体像

**ユーザー種別**:
1. **学生(小学3〜6年生)**: 問題を解き、プログラミング的思考を学習
2. **管理者(教員・研究者)**: 問題管理、学習データ分析、進捗確認

**主要機能**:
- 章・問題管理
- Scratch(.sb3)ファイルのアップロード・自動採点
- リアルタイムフィードバック
- 学年別ヒント表示
- レベル・経験値システム(ゲーミフィケーション)
- 学習進捗の可視化
- 詳細な学習ログ記録(研究用)

**システム構成**:
```
┌─────────────────────────────────────┐
│       学生(ブラウザ)               │
│  - 問題を解く                       │
│  - SB3ファイルをアップロード         │
│  - フィードバックを受け取る          │
└──────────┬──────────────────────┘
           │ HTTPS (JWT認証)
           ↓
┌─────────────────────────────────────┐
│    フロントエンド (React)           │
│  - React 18 + TypeScript            │
│  - Tailwind CSS                     │
│  - React Router v6                  │
└──────────┬──────────────────────┘
           │ REST API
           ↓
┌─────────────────────────────────────┐
│   バックエンド (Node.js)            │
│  - Express.js                       │
│  - JWT認証                          │
│  - Multer(ファイルアップロード)      │
│  - JSZip(SB3解析)                   │
│  - 採点エンジン(v2.1) ★            │
└──────────┬──────────────────────┘
           │ SQL
           ↓
┌─────────────────────────────────────┐
│   データベース (PostgreSQL)         │
│  - ユーザー情報                     │
│  - 問題データ(JSONB形式でSB3保存)   │
│  - 提出記録・学習ログ               │
└─────────────────────────────────────┘
```

### 3.1.3 学習の流れ

**ステップ1: ログイン**
- 学生がユーザー名・パスワードでログイン
- JWT トークンが発行され、以降の通信で使用

**ステップ2: 章・問題の選択**
- 章一覧から学習したい章を選択
- 章内の問題一覧が表示される

**ステップ3: 問題の理解**
- 問題文を読む
- 初期SB3ファイルをダウンロード

**ステップ4: Scratchでプログラム作成**
- Scratch公式サイト(https://scratch.mit.edu/)で初期SB3を開く
- 問題の指示に従ってプログラムを修正・作成
- 完成したら.sb3ファイルとして保存

**ステップ5: 提出**
- システムに.sb3ファイルをアップロード
- バックエンドで自動採点が実行される(数秒以内)

**ステップ6: フィードバック受け取り**
- 採点結果(スコア、正誤)が表示される
- 詳細なフィードバック(どこが正解/間違い)が提示される
- 必要に応じてヒントを参照

**ステップ7: 再挑戦または次の問題へ**
- 不正解の場合: 修正して再提出
- 正解の場合: 経験値獲得、次の問題へ進む

---

## 3.2 使用技術

### 3.2.1 開発環境

| カテゴリ | 技術 | バージョン |
|---------|------|-----------|
| 開発ツール | Monaca | - |
| コンテナ | Docker Compose | 3.8 |
| バージョン管理 | Git | - |

### 3.2.2 フロントエンド

| 技術 | バージョン | 用途 |
|-----|-----------|------|
| React | 18.x | UIフレームワーク |
| TypeScript | 4.x | 型安全な開発 |
| Tailwind CSS | 3.x | スタイリング |
| React Router | 6.x | ルーティング |
| Axios | 1.x | HTTP通信 |

**選定理由**:
- **React**: コンポーネント指向で保守性が高い
- **TypeScript**: 型チェックによりバグを未然に防ぐ
- **Tailwind CSS**: ユーティリティファーストで迅速なUI開発が可能

### 3.2.3 バックエンド

| 技術 | バージョン | 用途 |
|-----|-----------|------|
| Node.js | 18.x | サーバーサイド実行環境 |
| Express.js | 4.x | Webフレームワーク |
| PostgreSQL | 14.x | データベース |
| JWT | - | 認証トークン |
| Multer | 1.x | ファイルアップロード処理 |
| JSZip | 3.x | SB3ファイル(ZIP)の解析 |
| bcrypt | 5.x | パスワードハッシュ化 |

**選定理由**:
- **Node.js + Express**: JavaScriptで統一、非同期処理に強い
- **PostgreSQL**: JSONB型でSB3データを柔軟に保存可能
- **JWT**: ステートレスな認証、スケーラブル
- **JSZip**: .sb3ファイル(実体はZIP)をパースして中身のJSONを取得

### 3.2.4 インフラ

| 技術 | 用途 |
|-----|------|
| Docker Compose | 開発環境の統一、再現性確保 |
| PostgreSQL Container | データベース環境 |
| Node.js Container | バックエンド実行環境 |

**Docker Composeの利点**:
- ワンコマンドで環境構築可能
- 開発環境と本番環境の差異を最小化
- チーム開発での環境統一

---

## 3.3 Webアプリケーション内容

### 3.3.1 アプリケーションの流れ(状態遷移図)

**論文に掲載する図**:
```
┌──────────┐
│ ホーム画面 │
└─────┬────┘
      │
      ├─→ ログイン画面 ──→ 章選択画面 ──→ 問題一覧画面 ──→ 問題詳細画面
      │         ↓                                            ↓
      │    JWT発行                                    SB3ダウンロード
      │                                                       ↓
      │                                                  Scratchで作成
      │                                                       ↓
      │                                                  SB3アップロード
      │                                                       ↓
      │                                              提出・フィードバック画面
      │                                                       ↓
      │                                                  進捗管理画面
      │                                                       │
      └─→ ユーザー登録画面                                     │
                                                              ↓
                                                         次の問題へ
```

**状態遷移の詳細**:

1. **未認証状態**:
   - アクセス可能: ホーム画面、ログイン画面、ユーザー登録画面
   - 保護されたページにアクセスしようとすると自動的にログイン画面へリダイレクト

2. **認証済み(学生)**:
   - アクセス可能: 章選択、問題一覧、問題詳細、提出、フィードバック、進捗管理
   - 管理者専用ページはアクセス不可

3. **認証済み(管理者)**:
   - 学生用ページに加え、管理者ダッシュボードにアクセス可能
   - 問題の作成・編集、統計データ閲覧、ユーザー管理

### 3.3.2 ホーム画面

**目的**: システムの入口、ログインまたは新規登録への誘導

**表示内容**:
```
┌─────────────────────────────────────┐
│      Scratch学習支援システム        │
│                                     │
│  プログラミング的思考を                │
│  段階的に育成するシステムです          │
│                                     │
│   ┌──────────┐  ┌──────────┐   │
│   │ ログイン  │  │新規登録   │   │
│   └──────────┘  └──────────┘   │
│                                     │
│  ※ 小学3〜6年生向け                 │
└─────────────────────────────────────┘
```

**機能**:
- ログインボタン: クリックでログイン画面へ遷移
- 新規登録ボタン: クリックでユーザー登録画面へ遷移
- シンプルで分かりやすいデザイン(小学生が迷わない)

**実装ファイル**: `frontend/src/pages/Home.tsx`

### 3.3.3 ログイン画面

**目的**: ユーザー認証、システムへの安全なアクセス

**表示内容**:
```
┌─────────────────────────────────────┐
│           ログイン                  │
│                                     │
│  ユーザー名:                        │
│  ┌─────────────────────────────┐  │
│  │                              │  │
│  └─────────────────────────────┘  │
│                                     │
│  パスワード:                        │
│  ┌─────────────────────────────┐  │
│  │ ••••••••                     │  │
│  └─────────────────────────────┘  │
│                                     │
│       ┌──────────┐                │
│       │ログイン   │                │
│       └──────────┘                │
│                                     │
│  ※ アカウントがない方は新規登録へ    │
└─────────────────────────────────────┘
```

**機能**:
1. **ユーザー名・パスワード入力**
2. **ログインボタンクリック**
3. **バックエンドで認証処理**:
   - パスワードをbcryptでハッシュ化して照合
   - 正しければJWTトークンを発行
4. **トークンをlocalStorageに保存**
5. **章選択画面へ自動遷移**

**エラーハンドリング**:
- ユーザー名またはパスワードが間違っている場合: エラーメッセージ表示
- ネットワークエラー: 「接続に失敗しました」表示

**セキュリティ対策**:
- パスワードは平文で送信せず、HTTPS通信
- バックエンドでbcryptによるハッシュ照合
- ログイン失敗時も具体的なエラー(どちらが間違いか)は表示しない

**実装ファイル**: `frontend/src/pages/Login.tsx`

**関連API**:
```
POST /api/auth/login
Body: { username: string, password: string, userType: 'student' }
Response: { token: string, user: {...} }
```

### 3.3.4 ユーザー登録画面

**目的**: 新規ユーザーのアカウント作成

**表示内容**:
```
┌─────────────────────────────────────┐
│          新規登録                   │
│                                     │
│  ユーザー名:                        │
│  ┌─────────────────────────────┐  │
│  │                              │  │
│  └─────────────────────────────┘  │
│  ※ ログインに使います                │
│                                     │
│  ニックネーム:                      │
│  ┌─────────────────────────────┐  │
│  │                              │  │
│  └─────────────────────────────┘  │
│  ※ 画面に表示される名前です          │
│                                     │
│  パスワード:                        │
│  ┌─────────────────────────────┐  │
│  │ ••••••••                     │  │
│  └─────────────────────────────┘  │
│  ※ 8文字以上で設定してください       │
│                                     │
│  学年:                              │
│  ┌─────────────────────────────┐  │
│  │ ▼ 3年生                      │  │
│  └─────────────────────────────┘  │
│                                     │
│       ┌──────────┐                │
│       │ 登録する  │                │
│       └──────────┘                │
└─────────────────────────────────────┘
```

**入力項目**:
1. **ユーザー名**(必須): 半角英数字、一意である必要がある
2. **ニックネーム**(必須): システム上で表示される名前
3. **パスワード**(必須): 8文字以上
4. **学年**(必須): 3年生〜6年生から選択

**バリデーション**:
- ユーザー名: 既に使用されていないかチェック
- パスワード: 8文字以上の条件を満たすかチェック
- 全項目必須入力

**登録処理の流れ**:
1. フロントエンドでバリデーション
2. バックエンドに登録リクエスト送信
3. バックエンドでパスワードをbcryptでハッシュ化
4. データベースに保存(初期レベル=1, 経験値=0)
5. 自動でログイン処理実行
6. 章選択画面へ遷移

**実装ファイル**: `frontend/src/pages/Register.tsx`

**関連API**:
```
POST /api/auth/register
Body: { username, nickname, password, grade }
Response: { message: 'User created', token, user }
```

### 3.3.5 章選択画面

**目的**: 学習する章を選択

**表示内容**:
```
┌─────────────────────────────────────┐
│  ようこそ、〇〇さん!  レベル: 5    │
│                                     │
│         章を選んでね                │
│                                     │
│  ┌─────────────────────────────┐  │
│  │ 第1章: プログラムの基本        │  │
│  │ 進捗: 5/8問クリア              │  │
│  │ ★★★☆☆                       │  │
│  └─────────────────────────────┘  │
│                                     │
│  ┌─────────────────────────────┐  │
│  │ 第2章: 繰り返しを使おう        │  │
│  │ 進捗: 2/6問クリア              │  │
│  │ ★★☆☆☆                       │  │
│  └─────────────────────────────┘  │
│                                     │
│  ┌─────────────────────────────┐  │
│  │ 第3章: 条件分岐にチャレンジ    │  │
│  │ 進捗: 0/10問クリア             │  │
│  │ ☆☆☆☆☆ (未開始)              │  │
│  └─────────────────────────────┘  │
│                                     │
│   [進捗を見る]  [ログアウト]        │
└─────────────────────────────────────┘
```

**表示情報**:
- ユーザーのニックネーム、現在のレベル
- 各章のタイトル、説明
- 進捗状況(〇問中〇問クリア)
- 難易度(星の数で表示)

**機能**:
- 章をクリック → その章の問題一覧画面へ遷移
- 進捗を見るボタン → 進捗管理画面へ遷移
- ログアウトボタン → ホーム画面へ戻る

**データ取得**:
```
GET /api/problems/chapters
Response: [
  {
    id: 1,
    title: "プログラムの基本",
    description: "...",
    order_number: 1,
    progress: { completed: 5, total: 8 }
  },
  ...
]
```

**実装ファイル**: `frontend/src/pages/ChapterList.tsx`

### 3.3.6 問題一覧画面

**目的**: 選択した章内の問題一覧を表示

**表示内容**:
```
┌─────────────────────────────────────┐
│  第1章: プログラムの基本            │
│  「順次処理の理解から始めよう!」     │
│                                     │
│  ┌─────────────────────────────┐  │
│  │ 1. [穴埋め] ネコを10歩動かそう │  │
│  │    難易度: ★☆☆☆☆             │  │
│  │    ✓ クリア済み (85点)         │  │
│  └─────────────────────────────┘  │
│                                     │
│  ┌─────────────────────────────┐  │
│  │ 2. [予測] プログラムの結果は?  │  │
│  │    難易度: ★★☆☆☆             │  │
│  │    ✓ クリア済み (100点)        │  │
│  └─────────────────────────────┘  │
│                                     │
│  ┌─────────────────────────────┐  │
│  │ 3. [間違い探し] バグを直そう   │  │
│  │    難易度: ★★★☆☆             │  │
│  │    → 未クリア                  │  │
│  └─────────────────────────────┘  │
│                                     │
│       [章選択に戻る]                │
└─────────────────────────────────────┘
```

**表示情報**:
- 問題番号、タイトル
- 問題タイプ(穴埋め/予測/間違い探し/ミッション)のアイコン
- 難易度(星1〜5)
- クリア状況(✓クリア済み、スコア表示 or 未クリア)

**機能**:
- 問題をクリック → 問題詳細画面へ遷移
- クリア済みの問題も再挑戦可能

**データ取得**:
```
GET /api/problems/chapter/:chapterId
Response: [
  {
    id: 1,
    title: "ネコを10歩動かそう",
    problem_type: "fill_blank",
    difficulty: 1,
    user_progress: { is_completed: true, best_score: 85 }
  },
  ...
]
```

**実装ファイル**: `frontend/src/pages/ProblemList.tsx`

### 3.3.7 問題詳細画面

**目的**: 問題文の表示、SB3ダウンロード、ファイルアップロード

**表示内容**:
```
┌─────────────────────────────────────┐
│  問題1: ネコを10歩動かそう          │
│  タイプ: [穴埋め]  難易度: ★☆☆☆☆ │
│                                     │
│  【問題文】                         │
│  ネコのスプライトを10歩前に         │
│  進めるプログラムを完成させよう。    │
│  「○○歩動かす」の○○に数字を       │
│  入れてください。                   │
│                                     │
│  【学習のポイント】                 │
│  ・「動き」ブロックの使い方         │
│  ・数値の入力方法                   │
│                                     │
│  ┌──────────┐                    │
│  │初期ファイルを│                    │
│  │ダウンロード  │                    │
│  └──────────┘                    │
│                                     │
│  【提出】                           │
│  完成したら.sb3ファイルをアップロード:│
│  ┌─────────────────────────────┐  │
│  │ ファイルを選択...             │  │
│  └─────────────────────────────┘  │
│                                     │
│       ┌──────────┐                │
│       │ 提出する  │                │
│       └──────────┘                │
│                                     │
│  💡 ヒントを見る(残り3回)           │
│                                     │
│       [問題一覧に戻る]              │
└─────────────────────────────────────┘
```

**機能**:

1. **初期ファイルダウンロード**:
   - クリックでinitial_sb3_dataをZIP化して.sb3ファイルとしてダウンロード
   - Scratch公式サイトで開ける

2. **ファイルアップロード**:
   - .sb3ファイルのみ受け付け
   - ドラッグ&ドロップにも対応

3. **提出ボタン**:
   - クリックで採点処理開始
   - ローディング表示(採点中...)
   - 完了後、提出・フィードバック画面へ遷移

4. **ヒント表示**:
   - 学年に応じたヒントをモーダルで表示
   - 使用回数制限あり(例: 各問題3回まで)

**データ取得**:
```
GET /api/problems/:problemId
Response: {
  id: 1,
  title: "ネコを10歩動かそう",
  description: "...",
  problem_type: "fill_blank",
  learning_objective: "...",
  initial_sb3_data: {...},  // JSONB
  hints: [
    { hint_text: "「動き」のブロックを使います", order_number: 1 },
    ...
  ]
}
```

**提出処理**:
```
POST /api/submissions/:problemId
Body: FormData(sb3ファイル)
Response: {
  success: true,
  score: 85,
  isCorrect: false,
  feedback: {
    summary: "85点: 惜しい!",
    details: [...],
    hints: [...]
  }
}
```

**実装ファイル**:
- `frontend/src/pages/ProblemPage.tsx`
- `frontend/src/components/HintBubble.tsx`

### 3.3.8 提出・フィードバック画面

**目的**: 採点結果と詳細なフィードバックの表示

**表示内容(不正解の場合)**:
```
┌─────────────────────────────────────┐
│         採点結果                    │
│                                     │
│     スコア: 85点                    │
│     結果: もう一息!                 │
│                                     │
│  【フィードバック】                 │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━  │
│  ✓ 成功                            │
│    「動き」ブロックは正しく          │
│    使われています                   │
│                                     │
│  ⚠ 警告                            │
│    移動距離が少し違います           │
│    (期待: 10歩, 実際: 9歩)          │
│                                     │
│  【ヒント】                         │
│  💡 「○○歩動かす」の数値を         │
│     もう一度確認してみましょう      │
│                                     │
│  ┌──────────┐  ┌──────────┐ │
│  │もう一度挑戦│  │次の問題へ │ │
│  └──────────┘  └──────────┘ │
└─────────────────────────────────────┘
```

**表示内容(正解の場合)**:
```
┌─────────────────────────────────────┐
│         🎉 正解! 🎉                │
│                                     │
│     スコア: 100点                   │
│     獲得経験値: +50 EXP             │
│                                     │
│  【フィードバック】                 │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━  │
│  ✓ 完璧です!                       │
│    すべてのブロックが正しく          │
│    配置されています                 │
│                                     │
│  ✓ 数値も正確                      │
│    10歩の移動が正しく                │
│    実装されています                 │
│                                     │
│  【学習のまとめ】                   │
│  「動き」ブロックの使い方を          │
│  マスターしました!                  │
│                                     │
│  ┌──────────┐  ┌──────────┐ │
│  │もう一度挑戦│  │次の問題へ │ │
│  └──────────┘  └──────────┘ │
└─────────────────────────────────────┘
```

**フィードバックの種類**:

1. **✓ 成功(Success)**:
   - 緑色で表示
   - 正しく実装された部分を褒める
   - 例: 「繰り返しブロックが正しく使われています」

2. **⚠ 警告(Warning)**:
   - 黄色で表示
   - 部分的に正しいが改善の余地がある
   - 例: 「数値が少し違います(期待: 10, 実際: 9)」

3. **✗ エラー(Error)**:
   - 赤色で表示
   - 明確な間違いを指摘
   - 例: 「必要なブロックが見つかりません: 『10歩動かす』」

**機能**:
- もう一度挑戦ボタン: 問題詳細画面に戻る
- 次の問題へボタン: 次の問題の詳細画面へ遷移

**実装ファイル**: `frontend/src/components/FeedbackDisplay.tsx`

### 3.3.9 進捗管理画面

**目的**: 学習の進捗状況を可視化

**表示内容**:
```
┌─────────────────────────────────────┐
│      〇〇さんの学習記録             │
│                                     │
│  【現在のステータス】               │
│  ┌─────────────────────────────┐  │
│  │ レベル: 5                      │  │
│  │ 経験値: 450 / 600              │  │
│  │ ■■■■■■■□□□ (75%)      │  │
│  └─────────────────────────────┘  │
│                                     │
│  【章別進捗】                       │
│  第1章: プログラムの基本            │
│    ■■■■■□□□ 5/8問クリア     │
│                                     │
│  第2章: 繰り返しを使おう            │
│    ■■□□□□ 2/6問クリア         │
│                                     │
│  【最近の提出履歴】                 │
│  ┌─────────────────────────────┐  │
│  │ 2025/1/15 14:30                │  │
│  │ 第1章 問題5: 100点 ✓           │  │
│  └─────────────────────────────┘  │
│  ┌─────────────────────────────┐  │
│  │ 2025/1/15 14:15                │  │
│  │ 第1章 問題4: 85点 (再挑戦)     │  │
│  └─────────────────────────────┘  │
│                                     │
│  【学習統計】                       │
│  - 総提出回数: 23回                 │
│  - 正解率: 78%                      │
│  - 平均スコア: 87点                 │
│                                     │
│       [章選択に戻る]                │
└─────────────────────────────────────┘
```

**表示情報**:
1. **現在のレベルと経験値**: プログレスバーで可視化
2. **章別進捗**: 各章の完了率
3. **最近の提出履歴**: タイムスタンプ、問題名、スコア
4. **学習統計**: 総提出回数、正解率、平均スコアなど

**データ取得**:
```
GET /api/users/progress
Response: {
  user: { level: 5, exp: 450, max_exp: 600 },
  chapter_progress: [...],
  recent_submissions: [...],
  statistics: { total_attempts: 23, correct_rate: 0.78, avg_score: 87 }
}
```

**実装ファイル**: `frontend/src/pages/Progress.tsx`

### 3.3.10 管理者ダッシュボード

**目的**: 教員・研究者向けの管理機能

**表示内容**:
```
┌─────────────────────────────────────┐
│      管理者ダッシュボード           │
│                                     │
│  【ユーザー統計】                   │
│  - 総ユーザー数: 45人               │
│  - アクティブユーザー: 32人(今週)   │
│  - 平均レベル: 4.2                  │
│                                     │
│  【問題別統計】                     │
│  ┌─────────────────────────────┐  │
│  │ 第1章 問題3                    │  │
│  │ 正解率: 45% (低い)             │  │
│  │ 平均試行回数: 3.2回            │  │
│  │ → 難易度調整を検討             │  │
│  └─────────────────────────────┘  │
│                                     │
│  【問題管理】                       │
│  ┌──────────┐  ┌──────────┐ │
│  │問題を追加  │  │問題を編集 │ │
│  └──────────┘  └──────────┘ │
│                                     │
│  【データエクスポート】             │
│  ┌──────────────────────────┐   │
│  │ 学習ログをCSVでダウンロード  │   │
│  └──────────────────────────┘   │
│                                     │
│  【ユーザー管理】                   │
│  - ユーザー一覧                     │
│  - 詳細な学習履歴閲覧               │
└─────────────────────────────────────┘
```

**主要機能**:
1. **ユーザー統計**: 全体的な利用状況
2. **問題別統計**: 各問題の正解率、平均試行回数
3. **問題管理**: 新規問題の追加、既存問題の編集
4. **データエクスポート**: 研究用データのダウンロード(CSV形式)
5. **ユーザー管理**: 個別ユーザーの詳細な学習履歴

**実装ファイル**: `frontend/src/pages/AdminDashboard.tsx`

### 3.3.11 データベースについて

**使用DBMS**: PostgreSQL 14.x

**選定理由**:
- **JSONB型**: SB3ファイルの内容(project.json)をそのまま保存可能
- **高速検索**: JSONBのインデックスにより、ブロック構造の検索が高速
- **信頼性**: トランザクション処理が堅牢
- **拡張性**: 将来的なデータ増加にも対応可能

**ER図**(論文に掲載):
```
[admins] 1───M [users]
              │
              │ admin_id
              │
[chapters] 1───M [problems] 1───M [hints]
              │                   │
              │ chapter_id         │ problem_id
              │                   │ grade (1-6)
              │ problem_id
              │
              M
              │
         [submissions] ←─── user_id, problem_id
              │
              │
         [submission_attempts]
```

**テーブル詳細**:

**1. users(学生)**
```sql
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  username VARCHAR(50) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  nickname VARCHAR(50),
  admin_id INTEGER REFERENCES admins(id),
  level INTEGER DEFAULT 1,         -- レベル
  exp INTEGER DEFAULT 0,            -- 経験値
  grade INTEGER CHECK (grade BETWEEN 1 AND 6),  -- 学年
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

**特徴**:
- `level`, `exp`: ゲーミフィケーション要素
- `grade`: ヒントの出し分けに使用(3〜6年生)

**2. admins(管理者)**
```sql
CREATE TABLE admins (
  id SERIAL PRIMARY KEY,
  admin_username VARCHAR(50) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);
```

**3. chapters(章)**
```sql
CREATE TABLE chapters (
  id SERIAL PRIMARY KEY,
  title VARCHAR(100) NOT NULL,
  description TEXT,
  order_number INTEGER NOT NULL,    -- 表示順序
  created_at TIMESTAMP DEFAULT NOW()
);
```

**4. problems(問題) ★重要**
```sql
CREATE TABLE problems (
  id SERIAL PRIMARY KEY,
  chapter_id INTEGER REFERENCES chapters(id),
  title VARCHAR(100) NOT NULL,
  description TEXT,                 -- 問題文
  problem_type VARCHAR(20) CHECK (problem_type IN
    ('fill_blank', 'predict', 'find_error', 'mission')),
  learning_objective TEXT,          -- 学習のポイント
  initial_sb3_data JSONB,           -- 初期SB3ファイル(JSONB形式) ★
  correct_sb3_data JSONB,           -- 正解SB3ファイル(JSONB形式) ★
  image_url VARCHAR(255),           -- 問題画像(あれば)
  order_number INTEGER NOT NULL,
  difficulty INTEGER CHECK (difficulty BETWEEN 1 AND 5),
  created_at TIMESTAMP DEFAULT NOW()
);
```

**JSONB形式のSB3データ例**:
```json
{
  "targets": [
    {
      "isStage": false,
      "name": "Sprite1",
      "variables": {
        "var_id_123": ["カウンター", 0]
      },
      "blocks": {
        "block_id_456": {
          "opcode": "motion_movesteps",
          "inputs": {
            "STEPS": [1, [4, "10"]]
          }
        }
      }
    }
  ]
}
```

**JSONB型の利点**:
- 階層構造をそのまま保存
- PostgreSQLのJSON関数で柔軟に検索可能
- インデックスによる高速検索

**5. hints(ヒント)**
```sql
CREATE TABLE hints (
  id SERIAL PRIMARY KEY,
  problem_id INTEGER REFERENCES problems(id),
  grade INTEGER CHECK (grade BETWEEN 1 AND 6),  -- 学年別 ★
  hint_text TEXT NOT NULL,
  order_number INTEGER NOT NULL,     -- ヒントの表示順
  created_at TIMESTAMP DEFAULT NOW()
);
```

**学年別ヒントの例**:
```
問題: 「10歩動かすプログラムを作ろう」

3年生向けヒント: 「みどりいろの『うごき』のブロックをつかうよ」
4年生向けヒント: 「『動き』カテゴリの『10歩動かす』ブロックを使います」
5〜6年生向けヒント: 「motion_movestepsブロックのパラメータを10に設定」
```

**6. submissions(最終提出記録)**
```sql
CREATE TABLE submissions (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  problem_id INTEGER REFERENCES problems(id),
  is_correct BOOLEAN,
  score NUMERIC(5,2),               -- 0〜100点
  total_attempts INTEGER DEFAULT 1, -- 累計提出回数
  completed_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(user_id, problem_id)       -- 1ユーザー・1問題につき1レコード
);
```

**UPSERT(INSERT ON CONFLICT)で更新**:
```sql
INSERT INTO submissions (user_id, problem_id, is_correct, score, total_attempts)
VALUES (1, 5, true, 100, 1)
ON CONFLICT (user_id, problem_id)
DO UPDATE SET
  is_correct = EXCLUDED.is_correct,
  score = GREATEST(submissions.score, EXCLUDED.score),  -- 最高スコア保存
  total_attempts = submissions.total_attempts + 1,
  completed_at = NOW();
```

**7. submission_attempts(全試行記録) ★研究用**
```sql
CREATE TABLE submission_attempts (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  problem_id INTEGER REFERENCES problems(id),
  attempt_number INTEGER NOT NULL,  -- 何回目の提出か
  submitted_sb3_data JSONB,         -- 提出されたSB3ファイル ★
  is_correct_attempt BOOLEAN,
  score NUMERIC(5,2),
  feedback JSONB,                   -- フィードバック詳細 ★
  timestamp TIMESTAMP DEFAULT NOW()
);
```

**研究における重要性**:
- **全試行を記録**: 学習プロセスの分析が可能
- **submitted_sb3_data**: どのようなプログラムを提出したか
- **feedback**: どのようなフィードバックを受けたか
- **時系列分析**: 学習の改善過程を追跡可能

**データベース図の作成方法**:
- draw.io、Lucidchart、dbdiagram.ioなどのツールを使用
- ER図として論文に掲載
- リレーション(1対多)を矢印で明示

---

## 3.4 バックエンド・フロントエンドの機能分担

**図を論文に掲載**:
```
┌─────────────────────────────────────┐
│       フロントエンド                │
│       (React + TypeScript)          │
│                                     │
│  【責務】                           │
│  - UI表示                           │
│  - ユーザー操作のハンドリング        │
│  - フォームバリデーション            │
│  - ファイルのアップロード準備        │
│  - 認証状態の管理(localStorage)     │
│  - ルーティング                     │
└─────────┬───────────────────────┘
          │ REST API (JSON)
          │ JWT Token in Header
          ↓
┌─────────────────────────────────────┐
│       バックエンド                  │
│       (Node.js + Express)           │
│                                     │
│  【責務】                           │
│  - ビジネスロジック                 │
│  - 認証・認可(JWT検証)              │
│  - SB3ファイル解析(JSZip)           │
│  - 自動採点(採点エンジンv2.1) ★    │
│  - データベース操作                 │
│  - ログ記録                         │
└─────────┬───────────────────────┘
          │ SQL
          ↓
┌─────────────────────────────────────┐
│       データベース                  │
│       (PostgreSQL)                  │
│                                     │
│  【責務】                           │
│  - データの永続化                   │
│  - トランザクション管理             │
│  - JSONB検索                        │
└─────────────────────────────────────┘
```

**提出・採点の詳細フロー**:
```
[学生ブラウザ]
   │
   │ 1. .sb3ファイルを選択
   ↓
[Frontend]
   │
   │ 2. FormDataを作成
   │    const formData = new FormData();
   │    formData.append('sb3', file);
   ↓
   │ 3. Axios POST リクエスト
   │    POST /api/submissions/:problemId
   │    Headers: { Authorization: Bearer <token> }
   ↓
[Backend: authMiddleware]
   │
   │ 4. JWTトークン検証
   │    → req.user = { id, username }
   ↓
[Backend: submissionController]
   │
   │ 5. Multerでファイル受信
   │    const file = req.file
   ↓
   │ 6. JSZipでSB3解析
   │    const zip = await JSZip.loadAsync(file.buffer);
   │    const projectJSON = await zip.file('project.json').async('string');
   │    const submittedSB3 = JSON.parse(projectJSON);
   ↓
[Backend: DB Query]
   │
   │ 7. 正解SB3を取得
   │    SELECT correct_sb3_data FROM problems WHERE id = :problemId
   ↓
[Backend: scratchGradingEngine.js]
   │
   │ 8. 自動採点実行 ★
   │    compareScratchPrograms(correctSB3, submittedSB3)
   │      ├─ normalizeProgram()
   │      ├─ mapVariables() ← v2.1の核心
   │      ├─ checkBlocks()
   │      └─ generateFeedback()
   ↓
   │ 9. 採点結果 = { score, isCorrect, feedback }
   ↓
[Backend: DB Insert]
   │
   │ 10. submission_attemptsに記録(研究用)
   │ 11. submissionsをUPSERT(最高スコア更新)
   │ 12. 経験値・レベル更新
   ↓
[Backend: Response]
   │
   │ 13. JSON返却
   │     { score, isCorrect, feedback: {...} }
   ↓
[Frontend]
   │
   │ 14. FeedbackDisplayコンポーネントでフィードバック表示
   ↓
[学生ブラウザ]
   結果確認
```

---

## 3.5 自動採点エンジン(v2.1)

### 3.5.1 採点エンジン概要

**ファイルパス**: `backend/src/services/scratchGradingEngine.js`

**設計思想**:
1. **構文比較ではなくセマンティック比較**
   - 文字列の完全一致ではなく、プログラムの「意味」を理解して比較
   - 同じ動作をするプログラムなら、書き方が違っても正解

2. **変数名の違いを吸収(v2.1の核心)**
   - 小学生は自由な発想で変数名を付ける
   - 正解: "counter" ↔ 生徒: "りんご" でも、使い方が同じなら正解

3. **柔軟な評価**
   - 数値の±10%許容(小学生の入力誤差を考慮)
   - 例: 10歩動かすべきところを9歩 → 警告付きで部分点

4. **詳細なフィードバック**
   - 「不正解」だけでなく、どこが違うか具体的に指摘
   - 次の改善に繋がるヒント提供

**主要関数**:
```javascript
function compareScratchPrograms(correctSB3, submittedSB3) {
  // 1. プログラムの正規化
  const normalizedCorrect = normalizeProgram(correctSB3);
  const normalizedSubmitted = normalizeProgram(submittedSB3);

  // 2. 正解から要件抽出
  const requirements = extractRequirements(normalizedCorrect);

  // 3. 変数マッピング ★v2.1
  const variableMapping = mapVariables(normalizedCorrect, normalizedSubmitted);

  // 4. ブロック比較
  const blockResults = checkBlocks(
    requirements,
    normalizedSubmitted,
    variableMapping
  );

  // 5. 順序制約チェック
  const orderResults = checkOrderConstraints(requirements, normalizedSubmitted);

  // 6. フィードバック生成
  const feedback = generateFeedback(blockResults, orderResults);

  // 7. スコア計算
  const score = calculateScore(blockResults, orderResults);

  return {
    score: score,
    isCorrect: score >= 80,  // 80点以上で正解
    feedback: feedback
  };
}
```

### 3.5.2 変数マッピング機能(v2.1の核心)

**問題意識**:
```
正解プログラム:
  変数「カウンター」を1ずつ増やす
  変数「カウンター」が10になるまで繰り返す

生徒Aのプログラム:
  変数「りんご」を1ずつ増やす       ← 名前が違う!
  変数「りんご」が10になるまで繰り返す

生徒Bのプログラム:
  変数「x」を1ずつ増やす            ← 名前が違う!
  変数「x」が10になるまで繰り返す

→ 両方とも処理は正しいのに、変数名で不正解にするのは不適切
```

**解決策: 変数の使用パターンでマッピング**

**アルゴリズム**:
```javascript
function mapVariables(correctProgram, submittedProgram) {
  // ステップ1: 変数の使用パターンを解析
  const correctUsage = analyzeVariableUsage(correctProgram);
  // {
  //   "カウンター": {
  //     type: "number",
  //     initialValue: 0,
  //     usedInBlocks: ["data_changevariableby", "operator_lt"],
  //     incrementPattern: true,    // 増加する変数
  //     comparePattern: true       // 比較に使われる
  //   }
  // }

  const submittedUsage = analyzeVariableUsage(submittedProgram);
  // {
  //   "りんご": {
  //     type: "number",
  //     initialValue: 0,
  //     usedInBlocks: ["data_changevariableby", "operator_lt"],
  //     incrementPattern: true,
  //     comparePattern: true
  //   }
  // }

  // ステップ2: パターンマッチング
  const mapping = {};

  for (let correctVar of Object.keys(correctUsage)) {
    const correctPattern = correctUsage[correctVar];

    // 最も類似したパターンの変数を探す
    let bestMatch = null;
    let bestScore = 0;

    for (let submittedVar of Object.keys(submittedUsage)) {
      if (mapping[submittedVar]) continue; // 既にマッピング済み

      // 類似度計算
      const similarity = calculatePatternSimilarity(
        correctPattern,
        submittedUsage[submittedVar]
      );

      if (similarity > bestScore && similarity > 0.8) {
        bestScore = similarity;
        bestMatch = submittedVar;
      }
    }

    if (bestMatch) {
      mapping[correctVar] = bestMatch;
      // "カウンター" → "りんご"
    }
  }

  return mapping;
}

function calculatePatternSimilarity(pattern1, pattern2) {
  let score = 0;

  // 型が一致(number, string, boolean)
  if (pattern1.type === pattern2.type) score += 0.3;

  // 初期値が近い
  if (Math.abs(pattern1.initialValue - pattern2.initialValue) < 5) {
    score += 0.2;
  }

  // 使用ブロックの一致度
  const commonBlocks = intersection(
    pattern1.usedInBlocks,
    pattern2.usedInBlocks
  );
  score += (commonBlocks.length / pattern1.usedInBlocks.length) * 0.3;

  // インクリメントパターン一致
  if (pattern1.incrementPattern === pattern2.incrementPattern) {
    score += 0.1;
  }

  // 比較パターン一致
  if (pattern1.comparePattern === pattern2.comparePattern) {
    score += 0.1;
  }

  return score;  // 0.0〜1.0
}
```

**マッピング後の比較**:
```javascript
// 正解: 変数「カウンター」を1増やす
// 提出: 変数「りんご」を1増やす
// マッピング: { "カウンター": "りんご" }

function checkBlock(correctBlock, submittedBlock, variableMapping) {
  // 正解ブロックが変数「カウンター」を参照
  if (correctBlock.fields.VARIABLE === "カウンター") {
    const mappedVar = variableMapping["カウンター"]; // "りんご"

    // 提出ブロックがマッピングされた変数を使っているかチェック
    if (submittedBlock.fields.VARIABLE === mappedVar) {
      return { match: true };  // OK!
    }
  }
}
```

**効果**:
- 変数名が違っても、使い方が同じなら正解
- 小学生の創造性を尊重
- 本質的な理解(「変数とは何か」)を評価

### 3.5.3 セマンティック比較アルゴリズム

**ブロック比較のロジック**:
```javascript
function checkBlocks(requirements, submittedProgram, variableMapping) {
  const results = [];

  for (let requirement of requirements.blocks) {
    const { opcode, params, optional } = requirement;

    // 提出プログラムから該当ブロックを検索
    const matchingBlocks = findBlocksByOpcode(submittedProgram, opcode);

    if (matchingBlocks.length === 0) {
      if (optional) {
        results.push({
          type: 'warning',
          message: `推奨ブロック「${opcode}」が見つかりません`
        });
      } else {
        results.push({
          type: 'error',
          message: `必須ブロック「${opcode}」が見つかりません`,
          hint: `「${getBlockCategoryName(opcode)}」カテゴリを確認しましょう`
        });
      }
      continue;
    }

    // パラメータの比較
    for (let block of matchingBlocks) {
      const paramResult = compareParameters(
        params,
        block,
        variableMapping
      );

      if (paramResult.match) {
        results.push({
          type: paramResult.perfect ? 'success' : 'warning',
          message: paramResult.message
        });
        break;  // 1つでも一致すればOK
      }
    }
  }

  return results;
}
```

**パラメータの柔軟マッチング**:
```javascript
function compareParameters(expectedParams, actualBlock, variableMapping) {
  for (let paramName of Object.keys(expectedParams)) {
    const expected = expectedParams[paramName];
    const actual = actualBlock.inputs[paramName];

    // 数値の場合: ±10%許容
    if (typeof expected === 'number') {
      const diff = Math.abs(expected - actual);
      const tolerance = expected * 0.1;

      if (diff === 0) {
        return {
          match: true,
          perfect: true,
          message: `パラメータ「${paramName}」が正確です`
        };
      } else if (diff <= tolerance) {
        return {
          match: true,
          perfect: false,
          message: `パラメータ「${paramName}」が少し違います(期待: ${expected}, 実際: ${actual})`
        };
      } else {
        return {
          match: false,
          message: `パラメータ「${paramName}」が大きく違います`
        };
      }
    }

    // 変数の場合: マッピングを考慮
    if (expected.type === 'variable') {
      const mappedVar = variableMapping[expected.name];
      if (actual.name === mappedVar) {
        return {
          match: true,
          perfect: true,
          message: `変数「${mappedVar}」が正しく使われています`
        };
      }
    }
  }
}
```

### 3.5.4 フィードバック生成ロジック

**フィードバックの構造**:
```javascript
{
  summary: "85点: もう一息!",  // 総合評価
  details: [                    // 詳細なフィードバック
    {
      type: "success",          // success/warning/error
      message: "繰り返しブロックが正しく使われています"
    },
    {
      type: "warning",
      message: "移動距離が少し違います(期待: 10, 実際: 9)"
    }
  ],
  hints: [                      // 改善のヒント
    "「○○歩動かす」の数値をもう一度確認してみましょう"
  ]
}
```

**生成アルゴリズム**:
```javascript
function generateFeedback(blockResults, orderResults) {
  const details = [];
  const hints = [];

  // 成功メッセージ
  const successes = blockResults.filter(r => r.type === 'success');
  for (let s of successes) {
    details.push({ type: 'success', message: s.message });
  }

  // 警告メッセージ
  const warnings = blockResults.filter(r => r.type === 'warning');
  for (let w of warnings) {
    details.push({ type: 'warning', message: w.message });
  }

  // エラーメッセージ + ヒント
  const errors = blockResults.filter(r => r.type === 'error');
  for (let e of errors) {
    details.push({ type: 'error', message: e.message });
    if (e.hint) hints.push(e.hint);
  }

  // 総合評価
  const score = calculateScore(blockResults, orderResults);
  let summary;
  if (score >= 90) summary = `${score}点: 素晴らしい!`;
  else if (score >= 80) summary = `${score}点: よくできました!`;
  else if (score >= 60) summary = `${score}点: もう一息!`;
  else summary = `${score}点: もう一度チャレンジしてみましょう`;

  return { summary, details, hints };
}
```

---

## 3.6 4種類の問題タイプ

### 3.6.1 穴埋め式問題(fill_blank)

**目的**: プログラムの基本的な構造を理解する

**問題例**:
```
【問題】
ネコのスプライトを10歩前に進めるプログラムを完成させよう。
「○○歩動かす」の○○に正しい数字を入れてください。

【初期プログラム】
旗がクリックされたとき
  [  ]歩動かす    ← ここに10を入れる

【正解プログラム】
旗がクリックされたとき
  10歩動かす
```

**学習のポイント**:
- ブロックの意味を理解
- 数値パラメータの設定方法
- 文脈から適切な値を推測する力

**採点のポイント**:
- 「10歩動かす」ブロックの存在確認
- パラメータが10(または±1程度)であることを確認

**難易度設定**:
- レベル1(★☆☆☆☆): 1つの値を埋める
- レベル2(★★☆☆☆): 2〜3個の値を埋める
- レベル3(★★★☆☆): ブロック自体も選択が必要

### 3.6.2 予測問題(predict)

**目的**: プログラムの実行結果を予測する力を養う

**問題例**:
```
【問題】
次のプログラムを実行すると、スプライトはどこに移動するでしょうか?

【プログラム】
旗がクリックされたとき
  X座標を0、Y座標を0にする
  10歩動かす
  15度回す
  20歩動かす

【質問】
最終的なスプライトの位置を答えてください。
(選択肢またはScratch上で確認して提出)
```

**実装方法(2パターン)**:

**パターンA: 選択式**
- 選択肢を提示し、正しい結果を選ぶ
- システム側で簡単に自動採点可能

**パターンB: 実行確認式**(本システムで採用)
- 初期SB3に「予測すべきプログラム」が含まれている
- 学生は実際にScratchで実行して確認
- 正解の最終状態(座標、向きなど)を持つSB3を提出

**学習のポイント**:
- プログラムの実行フローを追う
- 各ブロックの効果を理解
- 座標系、角度の概念

**採点のポイント**:
- 最終的なスプライトの座標が正しいか
- 向きが正しいか

### 3.6.3 間違い探し問題(find_error)

**目的**: デバッグ能力を養う

**問題例**:
```
【問題】
次のプログラムは「ネコが正方形を描く」プログラムですが、
正しく動きません。間違いを見つけて修正してください。

【バグのあるプログラム】
旗がクリックされたとき
  ペンを下ろす
  3回繰り返す          ← 間違い!(4回であるべき)
    50歩動かす
    90度回す
  ペンを上げる

【正解プログラム】
旗がクリックされたとき
  ペンを下ろす
  4回繰り返す          ← 修正
    50歩動かす
    90度回す
  ペンを上げる
```

**バグの種類**(段階的に難易度設定):
1. **数値の間違い**: 繰り返し回数、移動距離、角度など
2. **ブロックの欠落**: 必要なブロックが抜けている
3. **ブロックの順序**: 順番が間違っている
4. **論理的エラー**: 条件分岐の条件が逆など

**学習のポイント**:
- プログラムを読み解く力
- 期待される動作と実際の動作の差異を発見
- 原因を特定し修正する力

**採点のポイント**:
- 正しく修正されたブロックの確認
- 意図した動作が実現できているか

### 3.6.4 ミッション型問題(mission)

**目的**: 知識を統合して創造的に問題を解決する

**問題例**:
```
【ミッション】
迷路を脱出するプログラムを作ろう!

【条件】
- スタート地点から始める
- 壁にぶつからないように進む
- ゴール地点に到達する
- 繰り返しや条件分岐を使って効率的に

【初期状態】
- 迷路のステージが用意されている
- スプライトはスタート地点に配置済み

【評価基準】
- ゴールに到達できたか(必須)
- 使用したブロック数(少ないほど高評価)
- 繰り返しを活用しているか
```

**学習のポイント**:
- これまで学んだ知識の統合
- 問題を分解して考える力
- 試行錯誤しながら解決策を見つける

**採点のポイント**(複合的):
1. **最低限の要件**: ゴール到達(必須ブロックの存在)
2. **効率性**: ブロック数が少ない、繰り返しを活用
3. **創造性**: ユニークな解法(ボーナス点)

**採点の実装**:
```javascript
// ゴール到達の確認
const hasGoalReachedBlock = checkFinalPosition(submittedSB3, goalPosition);

// 繰り返しブロックの使用確認
const usesLoop = findBlocksByOpcode(submittedSB3, 'control_repeat').length > 0;

// スコア計算
let score = 0;
if (hasGoalReachedBlock) score += 70;  // 基本点
if (usesLoop) score += 20;             // 繰り返し使用
if (blockCount < 10) score += 10;      // 効率性

return { score, isCorrect: score >= 70 };
```

---

## まとめ

この資料には、論文の第3章「提案」を執筆するために必要な以下の情報が含まれています:

1. **システム概要**: 目的、全体像、学習の流れ
2. **使用技術**: フロントエンド・バックエンド・インフラの技術選定理由
3. **画面構成**: 各画面の詳細(スクリーンショット用の説明含む)
4. **状態遷移図**: アプリケーションの流れ
5. **データベース設計**: ER図、テーブル詳細、JSONB活用
6. **機能分担**: フロントエンド・バックエンドの役割分担
7. **自動採点エンジン**: アルゴリズム詳細、変数マッピング(v2.1)の核心
8. **4種類の問題タイプ**: 各タイプの詳細な説明

**論文執筆時の注意点**:
- 図表を積極的に活用(ER図、状態遷移図、システム構成図など)
- コード例は簡潔に、主要な部分のみ掲載
- 変数マッピング機能(v2.1)は最大の貢献点なので詳しく記述
- 小学生向けという点を常に意識した設計であることを強調

この資料をWeb版Claudeプロジェクトに読み込ませて、論文執筆を進めてください!
